has_key = False
lamp_on = False
has_crowbar = False

print("=== ПОБЕГ ИЗ КОМНАТЫ ===")
print("Вы просыпаетесь в темной комнате. Вокруг тишина.")
input("Нажмите Enter, чтобы начать...")

choice1 = input("\nОсмотреть комнату (1) или попробовать открыть дверь (2)? ")

if choice1 == "1":
    print("\nВ темноте вы нащупали стол. На нем какие-то предметы.")
    choice2 = input("Потрогать предметы (1) или отойти от стола (2)? ")

    if choice2 == "1":
        print("\nВаши пальцы скользят по поверхности...")
        choice_item = input("Что берете? Ключ (1), Фонарик (2), Ломик (3)? ")

        if choice_item == "1":
            has_key = True
            print("Вы взяли холодный железный ключ.")
            choice3 = input("Осмотреть фонарик? (1 - да, 2 - нет): ")

            if choice3 == "1":
                print("\nВы берете старый фонарик.")
                lamp_choice = input("Попробовать включить (1), Оставить (2): ")

                if lamp_choice == "1":
                    light_choice = input("Батарейки есть? (1 - проверить, 2 - нет): ")
                    if light_choice == "1":
                        print("\nБатарейки на месте! Фонарик работает.")
                        lamp_on = True

            choice4 = input("\nВзять ломик? (1 - да, 2 - нет): ")
            if choice4 == "1":
                has_crowbar = True

            print(
                f"\nИнвентарь: Ключ: {'Да' if has_key else 'Нет'}, Фонарик: {'Горит' if lamp_on else 'Нет'}, Ломик: {'Да' if has_crowbar else 'Нет'}")
            choice5 = input("Открыть дверь ключом (1), Проверить окно (2), Осмотреть стену (3): ")

            if choice5 == "1":
                print("\nКлюч подошел! Дверь открыта.")
                choice6 = input("Перед вами коридор: налево (1), прямо (2), направо (3): ")

                if choice6 == "1":
                    print("\nВы идете налево... Слышен звук воды.")
                    choice7 = input("Идти на звук (1), Идти тихо (2)? ")

                    if choice7 == "1":
                        print("\nВы выходите к подземной реке.")
                        choice8 = input("Переплыть (1), Идти вдоль берега (2): ")

                        if choice8 == "1":
                            print("\nВы плывете через ледяную воду...")
                            choice9 = input("Плыть быстро (1), Экономить силы (2): ")

                            if choice9 == "1":
                                print("\nВы переплываете реку и находите выход на поверхность.")
                                choice10 = input("Идти к дороге (1), Спрятаться в лесу (2): ")

                                if choice10 == "1":
                                    print("\nВы выходите на трассу. Вас подбирает грузовик.")
                                    print("Водитель отвозит вас в город. Вы спасены!")
                                    print("\n=== КОНЕЦ 1: СПАСЕНИЕ ЧЕРЕЗ ТРАССУ ===")
                                else:
                                    print("\nВы прячетесь в лесу три дня, питаясь ягодами.")
                                    print("На четвертый день находите заброшенную деревню.")
                                    print("Там вы находите телефон и звоните в полицию.")
                                    print("\n=== КОНЕЦ 2: ВЫЖИВАНИЕ В ЛЕСУ ===")
                            else:
                                print("\nВы замерзаете в ледяной воде и тоните.")
                                print("\n=== КОНЕЦ 3: ГИБЕЛЬ В ЛЕДЯНОЙ ВОДЕ ===")

                        elif choice8 == "2":
                            print("\nВы идете вдоль берега час.")
                            choice9 = input("Продолжать идти (1), Отдохнуть (2): ")

                            if choice9 == "1":
                                print("\nВы находите старую железную дверь.")
                                choice10 = input("Открыть дверь (1), Пройти мимо (2): ")

                                if choice10 == "1":
                                    print("\nЗа дверью - лестница на поверхность.")
                                    print("Вы выходите в парк посреди города.")
                                    print("\n=== КОНЕЦ 4: ВОЗВРАЩЕНИЕ В ЦИВИЛИЗАЦИЮ ===")
                                else:
                                    print("\nВы идете дальше и находите аварийный выход.")
                                    print("Он ведет в метро. Вы спасены!")
                                    print("\n=== КОНЕЦ 5: ПОБЕГ ЧЕРЕЗ МЕТРО ===")
                            else:
                                print("\nВы отдыхаете и засыпаете от усталости.")
                                print("Просыпаетесь от звука вертолета. Это спасатели!")
                                print("\n=== КОНЕЦ 6: СПАСЕНИЕ С ВОЗДУХА ===")

                    elif choice7 == "2":
                        print("\nВы идете тихо и находите боковой проход.")
                        choice8 = input("Зайти в проход (1), Продолжить по коридору (2): ")

                        if choice8 == "1":
                            print("\nПроход ведет в вентиляционную шахту.")
                            choice9 = input("Ползти по шахте (1), Вернуться (2): ")

                            if choice9 == "1":
                                print("\nВы ползете 30 минут и вылезаете в подвале дома.")
                                print("Хозяева дома помогают вам.")
                                print("\n=== КОНЕЦ 7: ПОБЕГ ЧЕРЕЗ ВЕНТИЛЯЦИЮ ===")
                            else:
                                print("\nВы возвращаетесь и находите другую дверь.")
                                print("Она ведет прямо на улицу.")
                                print("\n=== КОНЕЦ 8: ПРОСТОЙ ВЫХОД ===")
                        else:
                            print("\nВы продолжаете идти и находите лифт.")
                            print("Лифт работает! Вы поднимаетесь наверх.")
                            print("\n=== КОНЕЦ 9: ЛИФТ НА СВОБОДУ ===")

                elif choice6 == "2":
                    print("\nВы идете прямо... Коридор расширяется.")
                    choice7 = input("Ускорить шаг (1), Осмотреться (2): ")

                    if choice7 == "1":
                        print("\nВы выбегаете в огромный зал.")
                        choice8 = input("Осмотреть зал (1), Искать выход (2): ")

                        if choice8 == "1":
                            print("\nВ зале висит карта эвакуации.")
                            if lamp_on:
                                print("При свете фонарика читаете карту.")
                                print("Находите кратчайший путь к выходу.")
                                print("\n=== КОНЕЦ 10: НАВИГАЦИЯ ПО КАРТЕ ===")
                            else:
                                print("В темноте вы спотыкаетесь о ящик.")
                                print("Ящик открывается - внутри ключи от машины.")
                                print("Находите гараж и уезжаете.")
                                print("\n=== КОНЕЦ 11: ВЕЗЕНИЕ В ТЕМНОТЕ ===")

                        elif choice8 == "2":
                            print("\nВы находите дверь с надписью 'Выход'.")
                            choice9 = input("Открыть дверь (1), Проверить другие двери (2): ")

                            if choice9 == "1":
                                print("\nДверь ведет на крышу.")
                                print("Вы спускаетесь по пожарной лестнице.")
                                print("\n=== КОНЕЦ 12: ПОЖАРНАЯ ЛЕСТНИЦА ===")
                            else:
                                print("\nВы находите склад с униформой.")
                                print("Переодеваетесь и выходите незамеченным.")
                                print("\n=== КОНЕЦ 13: МАСКИРОВКА ===")

                    elif choice7 == "2":
                        print("\nВы замечаете слабый свет в конце коридора.")
                        choice8 = input("Идти к свету (1), Проверить боковую дверь (2): ")

                        if choice8 == "1":
                            print("\nЭто окно! Вы выбиваете его и вылезаете.")
                            print("Оказываетесь во дворе жилого дома.")
                            print("\n=== КОНЕЦ 14: ОКНО НА СВОБОДУ ===")
                        else:
                            print("\nЗа дверью - офис с рабочим телефоном.")
                            print("Вы звоните в полицию.")
                            print("\n=== КОНЕЦ 15: ЗВОНОК СПАСЕНИЯ ===")

                elif choice6 == "3":
                    print("\nВы идете направо... Попадаете в библиотеку.")
                    choice7 = input("Искать карту (1), Читать книги (2): ")

                    if choice7 == "1":
                        print("\nВы находите старую карту здания с секретным ходом.")
                        choice8 = input("Следовать по карте (1), Искать самостоятельно (2): ")

                        if choice8 == "1":
                            print("\nКарта ведет к потайной двери за книжным шкафом.")
                            print("Вы выходите в тихий переулок.")
                            print("\n=== КОНЕЦ 16: СЕКРЕТНЫЙ ПРОХОД ===")
                        else:
                            print("\nВы находите окно на первом этаже.")
                            print("Открываете его и вылезаете наружу.")
                            print("\n=== КОНЕЦ 17: ОКНО БИБЛИОТЕКИ ===")

                    elif choice7 == "2":
                        print("\nВы читаете книгу о истории здания.")
                        choice8 = input("Продолжать читать (1), Все же искать выход (2): ")

                        if choice8 == "1":
                            print("\nВ книге находите описание тайного хода.")
                            print("Находите его и сбегаете.")
                            print("\n=== КОНЕЦ 18: КНИЖНАЯ ПОДСКАЗКА ===")
                        else:
                            print("\nВы находите дверь в читальный зал.")
                            print("Из зала есть выход в сад.")
                            print("\n=== КОНЕЦ 19: САДОВЫЙ ВЫХОД ===")

            elif choice5 == "2":
                print("\nВы подходите к окну. Оно забрано решеткой.")
                if has_crowbar:
                    print("Ломиком можно попробовать содрать решетку.")
                    window_choice = input("Попробовать (1), Не рисковать (2): ")

                    if window_choice == "1":
                        print("\nРешетка с грохотом падает на улицу.")
                        print("Шум привлекает прохожих. Они вызывают полицию.")
                        print("\n=== КОНЕЦ 20: ШУМНОЕ СПАСЕНИЕ ===")
                    else:
                        print("\nВы не решаетесь шуметь.")
                        print("Через несколько часов вас находит уборщик.")
                        print("Он помогает вам выбраться.")
                        print("\n=== КОНЕЦ 15: ЗВОНОК СПАСЕНИЯ ===")
                else:
                    print("Решетка слишком крепкая без инструмента.")
                    choice6 = input("Искать инструмент (1), Попробовать выломать руками (2): ")

                    if choice6 == "1":
                        print("\nВы находите в шкафу молоток!")
                        print("Разбиваете стекло и зовете на помощь.")
                        print("\n=== КОНЕЦ 20: ШУМНОЕ СПАСЕНИЕ ===")
                    else:
                        print("\nВы раните руки, но решетка не поддается.")
                        print("Истекая кровью, вы теряете сознание.")
                        print("Вас находят слишком поздно.")
                        print("\n=== КОНЕЦ 3: ГИБЕЛЬ В ЛЕДЯНОЙ ВОДЕ ===")

            elif choice5 == "3":
                print("\nВы осматриваете стену и находите слабое место.")
                if has_crowbar:
                    print("Ломиком можно проломить стену.")
                    wall_choice = input("Проломить стену (1), Постучать и послушать (2): ")

                    if wall_choice == "1":
                        print("\nВы пробиваете дыру в гипсокартоне.")
                        print("За стеной - соседняя квартира.")
                        print("Хозяева в шоке, но помогают вам.")
                        print("\n=== КОНЕЦ 7: ПОБЕГ ЧЕРЕЗ ВЕНТИЛЯЦИЮ ===")
                    else:
                        print("\nВы слышите за стеной голоса!")
                        print("Вы стучите, люди слышат и вызывают полицию.")
                        print("\n=== КОНЕЦ 15: ЗВОНОК СПАСЕНИЯ ===")
                else:
                    print("\nВы пытаетесь пробить стену кулаком.")
                    print("Только раните руку. Стена слишком прочная.")
                    print("Вы слабеете от потери крови.")
                    print("\n=== КОНЕЦ 3: ГИБЕЛЬ В ЛЕДЯНОЙ ВОДЕ ===")

        elif choice_item == "2":
            lamp_on = True
            print("Фонарик работает! Комната освещена.")
            print("Теперь видно ключ на столе и ломик в углу.")
            key_choice = input("Взять ключ (1), Взять ломик (2), Взять оба (3): ")

            if key_choice == "1":
                has_key = True
                print("Вы взяли ключ.")
                crowbar_choice = input("Взять еще и ломик? (1 - да, 2 - нет): ")
                if crowbar_choice == "1":
                    has_crowbar = True
                    print("Вы взяли ломик.")
            elif key_choice == "2":
                has_crowbar = True
                print("Вы взяли ломик.")
            elif key_choice == "3":
                has_key = True
                has_crowbar = True
                print("Вы взяли ключ и ломик.")

            print(
                f"\nИнвентарь: Ключ: {'Да' if has_key else 'Нет'}, Фонарик: Горит, Ломик: {'Да' if has_crowbar else 'Нет'}")
            if has_key:
                print("Дверь открывается ключом! Вы в коридоре.")
                print("Выбирайте путь: налево, прямо или направо.")
                path_choice = input("Налево (1), Прямо (2), Направо (3): ")

                if path_choice == "1":
                    print("\nВы находите выход через подвал.")
                    print("Поднимаетесь по лестнице на улицу.")
                    print("\n=== КОНЕЦ 8: ПРОСТОЙ ВЫХОД ===")
                elif path_choice == "2":
                    print("\nВы выходите в холл здания.")
                    print("Через главный вход выходите на улицу.")
                    print("\n=== КОНЕЦ 4: ВОЗВРАЩЕНИЕ В ЦИВИЛИЗАЦИЮ ===")
                else:
                    print("\nВы находите запасной выход.")
                    print("Он ведет в тихий двор.")
                    print("\n=== КОНЕЦ 19: САДОВЫЙ ВЫХОД ===")
            else:
                print("\nБез ключа дверь не открыть.")
                print("Вы пытаетесь выбить ее ломиком.")
                print("Дверь поддается! Вы сбегаете.")
                print("\n=== КОНЕЦ 12: ПОЖАРНАЯ ЛЕСТНИЦА ===")

        elif choice_item == "3":
            has_crowbar = True
            print("Вы взяли тяжелый ломик.")
            print("В темноте плохо видно. Искать фонарик?")
            search_light = input("Искать фонарик (1), Действовать в темноте (2): ")

            if search_light == "1":
                print("\nВы находите фонарик! Он работает.")
                lamp_on = True
                print("Теперь видно ключ на столе.")
                take_key = input("Взять ключ? (1 - да, 2 - нет): ")
                if take_key == "1":
                    has_key = True

                if has_key:
                    print("\nОткрываете дверь ключом.")
                    print("В коридоре находите указатель 'Выход'.")
                    print("Следуете по нему и сбегаете.")
                    print("\n=== КОНЕЦ 10: НАВИГАЦИЯ ПО КАРТЕ ===")
                else:
                    print("\nВыламываете дверь ломиком.")
                    print("Находите пожарный выход.")
                    print("\n=== КОНЕЦ 12: ПОЖАРНАЯ ЛЕСТНИЦА ===")
            else:
                print("\nВ темноте вы натыкаетесь на дверь.")
                print("Выбиваете ее ломиком.")
                print("За дверью - лестница на улицу.")
                print("\n=== КОНЕЦ 9: ЛИФТ НА СВОБОДУ ===")

    elif choice2 == "2":
        print("\nВы отходите от стола и натыкаетесь на шкаф.")
        stumble = input("Открыть шкаф (1), Обойти его (2): ")

        if stumble == "1":
            print("\nВ шкафу висит одежда и лежит рюкзак.")
            bag_choice = input("Проверить рюкзак (1), Надеть куртку (2): ")

            if bag_choice == "1":
                print("\nВ рюкзаке: фонарик с батарейками, ключи, бутылка воды.")
                lamp_on = True
                has_key = True
                print("Фонарик работает! И ключи есть!")
                water_choice = input("Выпить воду (1), Оставить на потом (2): ")

                print("\nОткрываете дверь ключами.")
                print("Перед вами - длинный коридор.")
                corridor_choice = input("Идти вперед (1), Повернуть налево (2): ")

                if corridor_choice == "1":
                    print("\nВы находите лифт. Он работает!")
                    print("Поднимаетесь на первый этаж.")
                    print("\n=== КОНЕЦ 9: ЛИФТ НА СВОБОДУ ===")
                else:
                    print("\nВы находите аварийный выход.")
                    print("Спускаетесь по лестнице на улицу.")
                    print("\n=== КОНЕЦ 5: ПОБЕГ ЧЕРЕЗ МЕТРО ===")

            elif bag_choice == "2":
                print("\nВы надеваете теплую куртку.")
                print("В кармане находите фонарик и ключ!")
                lamp_on = True
                has_key = True
                print("Открываете дверь и выходите.")
                print("На улице холодно, но в куртке тепло.")
                print("\n=== КОНЕЦ 1: СПАСЕНИЕ ЧЕРЕЗ ТРАССУ ===")

        else:
            print("\nВы обходите шкаф и находите потайную дверь.")
            print("Она не заперта. Вы проходите внутрь.")
            print("Это коридор службы доставки.")
            print("Выходите через грузовой выход.")
            print("\n=== КОНЕЦ 16: СЕКРЕТНЫЙ ПРОХОД ===")

elif choice1 == "2":
    print("\nДверь заперта. Нужен ключ.")
    choice_locked = input("Обыскать комнату (1), Попробовать выбить дверь (2): ")

    if choice_locked == "1":
        print("\nВы шарите в темноте...")
        search_dark = input("Искать на ощупь (1), Попробовать глаза привыкнут (2): ")

        if search_dark == "1":
            print("\nВы находите стол и предметы на нем.")
            feel_item = input("Что брать? (1 - что-то металлическое, 2 - что-то пластмассовое): ")

            if feel_item == "1":
                has_key = True
                print("Это ключ! Пытаетесь открыть дверь.")
                try_door = input("Открыть сразу (1), Сначала поискать фонарик (2): ")

                if try_door == "1":
                    print("\nДверь открывается!")
                    print("Выходите в пустой коридор.")
                    print("Находите выход по указателям.")
                    print("\n=== КОНЕЦ 14: ОКНО НА СВОБОДУ ===")
                else:
                    print("\nНаходите фонарик. Он работает!")
                    lamp_on = True
                    print("Освещаете комнату, находите ломик.")
                    has_crowbar = True
                    print("Открываете дверь и сбегаете.")
                    print("\n=== КОНЕЦ 18: КНИЖНАЯ ПОДСКАЗКА ===")

            elif feel_item == "2":
                lamp_on = True
                print("Это фонарик! Он работает.")
                print("Теперь видно ключ и ломик.")
                take_rest = input("Взять ключ и ломик? (1 - да, 2 - только ключ): ")

                if take_rest == "1":
                    has_key = True
                    has_crowbar = True
                    print("Открываете дверь и уходите.")
                    print("\n=== КОНЕЦ 2: ВЫЖИВАНИЕ В ЛЕСУ ===")
                else:
                    has_key = True
                    print("Открываете дверь, но в коридоре вас ждет охрана.")
                    print("Вы убегаете через окно.")
                    print("\n=== КОНЕЦ 17: ОКНО БИБЛИОТЕКИ ===")

        else:
            print("\nВы ждете 10 минут. Глаза привыкают к темноте.")
            print("Видите контуры предметов.")
            dark_choice = input("Взять то что блестит (1), То что большое (2): ")

            if dark_choice == "1":
                has_key = True
                print("Это ключ! Открываете дверь.")
                print("На улице ночь. Вы скрываетесь в темноте.")
                print("\n=== КОНЕЦ 17: ОКНО БИБЛИОТЕКИ ===")
            else:
                has_crowbar = True
                print("Это ломик! Выбиваете дверь.")
                print("Шум привлекает внимание, но вы успеваете сбежать.")
                print("\n=== КОНЕЦ 20: ШУМНОЕ СПАСЕНИЕ ===")

    elif choice_locked == "2":
        print("\nВы бьете плечом в дверь.")
        force_choice = input("Бить сильнее (1), Отдохнуть (2): ")

        if force_choice == "1":
            print("\nДверь поддается с треском!")
            print("Вы выбегаете, но задеваете плечом косяк.")
            print("С вывихом плеча бежите до ближайшей больницы.")
            print("\n=== КОНЕЦ 6: СПАСЕНИЕ С ВОЗДУХА ===")
        else:
            print("\nВы отдыхаете и слышите шаги за дверью.")
            print("Дверь открывается! Это уборщик.")
            print("Он помогает вам выбраться.")
            print("\n=== КОНЕЦ 13: МАСКИРОВКА ===")

else:
    print("\nВы замерли и не можете принять решение.")
    print("Проходит час...")
    frozen_choice = input("Очнуться (1), Остаться так (2): ")

    if frozen_choice == "1":
        print("\nВы встряхиваетесь и начинаете действовать.")
        print("На полу замечаете ключ! Подбираете его.")
        has_key = True
        print("Открываете дверь и быстро уходите.")
        print("\n=== КОНЕЦ 11: ВЕЗЕНИЕ В ТЕМНОТЕ ===")
    else:
        print("\nВы остаетесь в оцепенении на несколько часов.")
        print("Вас находит охрана и возвращает на место.")
        print("Шанс упущен.")
        print("\n=== КОНЕЦ 3: СМЕРТЬ ОТ БЕЗДЕЙСТВИЯ ===")


print("\n" + "=" * 50)
print("ИГРА ЗАВЕРШЕНА")

mood = input("\nКакое у вас настроение после игры? (1 - хорошее, 2 - нейтральное, 3 - плохое): ")

if mood == "1":
    print("Рад, что вам понравилось!")
elif mood == "2":
    print("Продолжение следует...")
else:
    print("Надеюсь, в следующий раз повезет больше.")

print("\n=== СПАСИБО ЗА ИГРУ! ===")
